services:
  dev:
    build:
      context: .
      target: dev
    ports:
      - "5173:5173"
    environment:
      CHOKIDAR_USEPOLLING: "1"
      TEMPLATE_IMAGE_URL: ${TEMPLATE_IMAGE_URL:-}
    volumes:
      - .:/app
      - node_modules:/app/node_modules
    command: >-
      sh -c "if [ ! -d node_modules/react ]; then npm install; fi && npm run dev -- --host 0.0.0.0 --port 5173"

  prod:
    profiles: ["prod"]
    build:
      context: .
      target: prod
      args:
        TEMPLATE_IMAGE_URL: ${TEMPLATE_IMAGE_URL:-}
    ports:
      - "8080:80"

volumes:
  node_modules:
